<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title> Testing subdomains in Sinatra -  hop.ie</title>
    <meta name="description" content="If you're setting up a site with multiple subdomains, your 4,5,6,7 might need a little 1,2,3.">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="/stylesheets/screen.css">
    

    

    <!--[if IE]>
      <link rel="stylesheet" href="/stylesheets/ie.css">
    <![endif]-->
    <link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=PT+Sans:regular" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro' rel="stylesheet" type="text/css">
    <link rel="canonical" href="/blog/sinatra-subdomains">
    <meta name="google-site-verification" content="4b2gG2_kr5STLh0RhE34iPvU59o591CoG9N6iYOazvw" />
    <script src="/javascripts/modernizr.js"></script>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/queue.v1.min.js"></script>
</head>
<body >
  <div class="page-container">
  	<header>
  	</header>

  	<div class="page clearfix">
    	<section class="content">
    		<article>

	<header>
	  <h1>Testing subdomains in Sinatra</h1>
	  <p class="date">August 12, 2012</p>
	</header>

	<section class="entry"><p>A side project I&#8217;m currently working on requires the setting up and testing of many subdomains. Since the project itself is quite light, I&#8217;ve chosen to build it in the superb <a href='http://www.sinatrarb.com/'>Sinatra</a>. When testing Sinatra apps locally, the usual address to test in browser is <code>0.0.0.0:4567</code>. While this is good enough for single domain projects, it&#8217;s a problem when you need to set up and test a project across multiple subdomains.</p>

<h2 id='using_hosts_file'>Using hosts file</h2>

<p>If you have a small number of URLs to test, adding them to your hosts file might be an option. The following format can be used in your hosts file:</p>

<pre><code>127.0.0.1	one.yourapp.dev
127.0.0.1	two.yourapp.dev
127.0.0.1	three.yourapp.dev</code></pre>

<p>You can then access these (assuming your app is running on port 4567) by visiting <code>one.yourapp.dev:4567</code> and see it running locally.</p>

<p>Alternatively, if you want to be able to test against a large range of subdomains, a fun alternative is to use <a href='http://pow.cx'>POW!!</a></p>

<h2 id='pow'>POW!!</h2>

<p><a href='http://pow.cx'>Pow!!</a> is a handy wrapper for running and testing multiple apps on local &#8220;.dev&#8221; URLs. It&#8217;s trivial to set up and fires up a server for you to save a few seconds each time. Installing is as easy as:</p>

<pre><code>curl get.pow.cx | sh</code></pre>

<p>Then setting up a symlink to your project:</p>

<pre><code>cd ~/.pow
ln -s /path/to/myapp myapp</code></pre>

<p><em>*Note: The docs seem to leave out the second &#8220;myapp&#8221; above when creating the symlink. This worked for me.</em></p>

<p>Restarting the server involves creating a text file in a <code>tmp</code> directory in your project, called <em>restart.txt</em>:</p>

<pre><code>touch tmp/restart.txt</code></pre>

<p>If you want the application to restart every time you refresh, create a text file called <em>always_restart.txt</em>:</p>

<pre><code>touch tmp/always_restart.txt</code></pre>

<p>Pow!! has <a href='http://pow.cx/manual.html'>more documentation here</a> should you need it, but you should now be able to visit <code>anything.myapp.dev</code> and access your app.</p>

<p>Now that you have the app running at subdomains, it&#8217;s time get Sinatra to sing along.</p>

<h2 id='sinatra_subdomain'>Sinatra Subdomain</h2>

<p>Enter <a href='http://rubydoc.info/gems/sinatra-subdomain/0.1.2/frames'>Sinatra Subdomain</a>, a handy gem from Brazil&#8217;s <a href='https://twitter.com/fnando'>@fnando</a>. The gem is <a href='http://rubydoc.info/gems/sinatra-subdomain/0.1.2/frames'>well documented</a> and easy to set up.</p>

<p>Installing the Sinatra Subdomain gem:</p>

<pre><code>sudo gem install sinatra-subdomain</code></pre>

<p>You&#8217;ll then want to require the gem in your app:</p>

<pre><code>require &quot;sinatra/subdomain&quot;</code></pre>

<p>The gem can then be used to target specific subdomains, or take a wildcard approach. If you&#8217;re specifying your subdomains, the following will respond to the subdomain <code>foo</code>:</p>

<pre><code>subdomain :foo do
  get &#39;/&#39; do
    &quot;What does #{subdomain} rhyme with? Oh, you!&quot;
  end
end</code></pre>

<p>In my case, I found it more useful to allow any subdomains and set up routes for them as a group:</p>

<pre><code>subdomain do
  # Route for the root
  get &#39;/&#39; do
    &quot;You&#39;re on the #{subdomain} home page! Good job!&quot;
  end
  # Route for a different page
  get &#39;/bananas&#39;
    &quot;You&#39;re #{subdomain} for bananas! Good job!&quot;
  end
end</code></pre>

<p>While this works well for <code>crazy.myapp.dev</code> and <code>mad.myapp.dev/bananas</code>, the above won&#8217;t work for <code>myapp.dev</code> without the subdomain. To catch this, add the following after the subdomain section:</p>

<pre><code>get &#39;/&#39; do
  &quot;Now that&#39;s more like it.&quot;
end</code></pre>

<p>You&#8217;ll now be set up to start putting together the logic for handling one, two or many subdomains. Good luck!</p></section>

	<section class="tags">
	  <ul>
	    <li>Filed under:</li>
	  
	    <li><a href="#">Development</a></li>
	  
	  </ul>
	</section>

</article>


    	</section>
    </div>
  </div>
	<footer class="clearfix">
	  <section class="footer-content">
	    <p>I am <a href="http://github.com/ccarpenterg">ccarpenterg on Github</a>, and <a href="https://alpha.app.net/donovan">@donovan</a> on app.net.</p>
		</section>
	</footer>

  <script id="bouncer-template" type="text/html">
    <span class="mask"></span>
    <span class="bounce1"></span>
	  <span class="bounce2"></span>
	  <span class="bounce3"></span>
	  <span class="bouncer">
	    <span class="ear1"></span>
	    <span class="ear2"></span>
	    <span class="eye1"></span>
	    <span class="eye2"></span>
	    <span class="mouth"></span>
	  </span>
  </script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="/javascripts/jquery.min.js"><\/script>')</script>
  <script src="/javascripts/main.js"></script>
  <script src="/javascripts/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>




  <script type="text/javascript">

    var _gaq = _gaq || [];
    
    _gaq.push(['_setAccount', 'UA-3481417-23']);
    _gaq.push(['_setDomainName', 'hop.ie']);
    _gaq.push(['_setSiteSpeedSampleRate', 10]);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

  </script>
</body>
</html>
